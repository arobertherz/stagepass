var Stagepass=(()=>{(function(){let d="stagepass_domain",h="stagepass";function b(t){return t==="debug"||t.endsWith(".sp")||t==="localhost"||t.startsWith("localhost:")}let f=new URLSearchParams(window.location.search),A=localStorage.getItem(d),D=A&&b(A),T=f.has(h);if(!D&&!T){let t=()=>{};console.log=t,console.warn=t,console.error=t,console.info=t,console.debug=t}function y(t,...l){var s;let e=localStorage.getItem(d);if(!e||e!=="debug"&&!e)return;let u=new Date().toTimeString().split(" ")[0],m="unknown";try{let a=(s=new Error().stack)==null?void 0:s.split(`
`);if(a){let i=a.find((r,n)=>n>2&&!r.includes("log"));if(i){let r=i.match(/(\/?([^\/\?:]+))(\?[^\s)]*)?:([0-9]+):[0-9]+/);r&&(m=`${r[2]}:${r[4]}`)}}}catch{}let S=`[\u{1F3AB} ${u} \u{1F4CD} ${m}]`;t==="error"?console.log(`%c${S}`,"color: red; font-weight: bold;",...l):console[t]?console[t](S,...l):console.log(S,t,...l)}let g=(...t)=>y("log",...t),$=(...t)=>y("warn",...t),v=(...t)=>y("error",...t);window.splog=g,window.spwarn=$,window.sperror=v;function L(t){return t?t.replace(/^https?:\/\//,"").replace(/\/$/,""):null}let k=!1;if(f.has(h)){let t=f.get(h);if(t==="off"||t==="0"||t==="false")localStorage.removeItem(d),g("\u{1F50C} Stagepass disconnected.");else if(t){let e=t==="debug"?"debug":L(t);e&&b(e)?(localStorage.setItem(d,e),g(e==="debug"?"\u{1F50D} Stagepass debug mode enabled.":`\u{1F50C} Stagepass connected to: ${e}`),k=!0):e&&!b(e)&&$(`Invalid domain: ${e}. Only .sp domains are allowed.`)}f.delete(h);let l=f.toString();window.history.replaceState({},"",window.location.pathname+(l?`?${l}`:"")+window.location.hash)}let o=localStorage.getItem(d);o&&!b(o)&&(localStorage.removeItem(d),o=null),o&&!k&&o!=="debug"&&g(`\u{1F50C} Stagepass connected to: ${o}`);let M=!!o,w=!!o&&o!=="debug",E=w?L(o):null,P=w?Date.now():0;function C(t,l,e,u,m){document.querySelectorAll(`${t}:not([data-stagepass-processed])`).forEach(s=>{s.setAttribute("data-stagepass-processed","true");let a=s.getAttribute(l),i=s.getAttribute(e);if(!i)return;if(!a&&i&&w&&E)try{let c=new URL(i).pathname.split("/");a=c[c.length-1]||c[c.length-2]}catch{let c=i.match(/\/([^\/\?#]+)(?:\?|#|$)/);c&&(a=c[1])}let r="";if(w&&a&&E){let n=a.startsWith("/")?a.substring(1):a;r=`https://${E}/${n}?_cb=${P}`}else i&&(r=i);if(r){let n=document.createElement(u);u==="script"?(n.src=r,Array.from(s.attributes).forEach(c=>{let p=c;m.includes(p.name)||n.setAttribute(p.name,p.value)}),!s.hasAttribute("async")&&!s.hasAttribute("defer")&&n.setAttribute("defer","")):(n.rel="stylesheet",n.href=r,Array.from(s.attributes).forEach(c=>{let p=c;m.includes(p.name)||n.setAttribute(p.name,p.value)})),s.parentNode?(s.parentNode.insertBefore(n,s),s.remove()):v(`${u} injection failed: No parent node`)}})}function I(){C("script[data-stagepass]","data-stagepass-path","data-src","script",["data-src","data-stagepass","data-stagepass-path"]),C('link[rel="stylesheet"][data-stagepass]',"data-stagepass-path","data-href","link",["href","data-href","data-stagepass","data-stagepass-path"])}I(),document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",I);function x(){if(!M)return;let t=document.createElement("div");t.id="stagepass-flag",t.textContent=o==="debug"?"STAGEPASS DEBUG":"STAGEPASS ACTIVE",t.style.cssText='font-size: 12px; line-height: 1; font-weight: bold; color: #fff; background-color: #D92662; padding: 4px 6px; z-index: 9999999999; position: fixed; top: 0; right: 0; cursor: pointer; border-radius: 0 0 0 4px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; user-select: none;',t.addEventListener("click",()=>{localStorage.removeItem(d),g("\u{1F50C} Stagepass disconnected."),window.location.reload()}),document.body?document.body.appendChild(t):document.addEventListener("DOMContentLoaded",()=>{document.body&&document.body.appendChild(t)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x()})();})();
